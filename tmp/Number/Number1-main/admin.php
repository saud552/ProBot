<?php 
$lang = $langs ?? [];
$txt = array(
"ar" => array(
"1" => "âœ… - ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø´Ø­Ù† Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù€ Ù…Ø¨Ù„Øº __point__",
"2" => "ØªÙ… Ø³Ø­Ø¨ __point__  Ù…Ù† Ø­Ø³Ø§Ø¨Ùƒ",
"3" => "ØªÙ… Ø­Ø¸Ø±Ùƒ Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙˆØª",
"4"=> "ØªÙ… Ø§Ù„ØºØ§Ø¡ Ø­Ø¸Ø±Ùƒ Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙˆØª",
),
"en" => array(
    "1" => "âœ… - Your account has been recharged with __point__",
    "2" => "__point__ has been deducted from your account",
    "3" => "You have been banned from using the bot",
    "4" => "You have been unbanned from using the bot",
),
"ru" => array(
    "1" => "âœ… - Ğ’Ğ°Ñˆ ÑÑ‡ĞµÑ‚ Ğ±Ñ‹Ğ» Ğ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½ Ğ½Ğ° ÑÑƒĞ¼Ğ¼Ñƒ __point__",
    "2" => "__point__ Ğ±Ñ‹Ğ»Ğ¾ ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¾ Ñ Ğ²Ğ°ÑˆĞµĞ³Ğ¾ ÑÑ‡ĞµÑ‚Ğ°",
    "3" => "Ğ’Ñ‹ Ğ±Ñ‹Ğ»Ğ¸ Ğ·Ğ°Ğ±Ğ°Ğ½ĞµĞ½Ñ‹ Ğ¾Ñ‚ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ±Ğ¾Ñ‚Ğ°",
    "4" => "Ğ’Ñ‹ Ğ±Ñ‹Ğ»Ğ¸ Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ğ´Ğ»Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ±Ğ¾Ñ‚Ğ°",
),
"fa" => array(
    "1" => "âœ… - Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§ Ø¨Ø§ Ù…Ø¨Ù„Øº __point__ Ø´Ø§Ø±Ú˜ Ø´Ø¯",
    "2" => "__point__ Ø§Ø² Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§ Ú©Ø³Ø± Ø´Ø¯",
    "3" => "Ø´Ù…Ø§ Ø§Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§Øª Ù…Ø³Ø¯ÙˆØ¯ Ø´Ø¯Ù‡â€ŒØ§ÛŒØ¯",
    "4" => "Ù…Ø³Ø¯ÙˆØ¯ÛŒØª Ø´Ù…Ø§ Ø§Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§Øª Ù„ØºÙˆ Ø´Ø¯",
),
"cht" => array(
    "1" => "âœ… - æ‚¨çš„å¸³æˆ¶å·²åŠ å€¼ __point__",
    "2" => "__point__ å·²å¾æ‚¨çš„å¸³æˆ¶ä¸­æ‰£é™¤",
    "3" => "æ‚¨å·²è¢«ç¦æ­¢ä½¿ç”¨æ©Ÿå™¨äºº",
    "4" => "æ‚¨å·²è¢«è§£é™¤ç¦æ­¢ä½¿ç”¨æ©Ÿå™¨äºº",
),
"chb" => array(
    "1" => "âœ… - æ‚¨çš„è´¦æˆ·å·²å……å€¼ __point__",
    "2" => "__point__ å·²ä»æ‚¨çš„è´¦æˆ·ä¸­æ‰£é™¤",
    "3" => "æ‚¨å·²è¢«ç¦æ­¢ä½¿ç”¨æœºå™¨äºº",
    "4" => "æ‚¨å·²è¢«è§£é™¤ç¦æ­¢ä½¿ç”¨æœºå™¨äºº",
),
"tr" => array(
    "1" => "âœ… - HesabÄ±nÄ±za __point__ yÃ¼klendi",
    "2" => "__point__ bakiyenizden dÃ¼ÅŸÃ¼ldÃ¼",
    "3" => "Botu kullanmanÄ±z engellendi",
    "4" => "Botu kullanma engeliniz kaldÄ±rÄ±ldÄ±",
)
);
if ($text == "/start" || $text == "/admin" || $data == "back") {
	$btn = 
	mkBtn(
		array(
			array(
				"Ø§Ø¶Ø§ÙØ© Ø±ØµÙŠØ¯" => "addPoint",
				"Ø³Ø­Ø¨ Ø±ØµÙŠØ¯" => "takePoint"
			),
			array(
				"Ø­Ø¸Ø± Ø¹Ø¶Ùˆ" => "ban",
				"Ø§Ù„ØºØ§Ø¡  Ø§Ù„Ø­Ø¸Ø±" => "unban"
			),
			array(
				"Ø§Ø¶Ø§ÙØ© ÙˆÙƒÙŠÙ„" => "addWk",
				"Ø­Ø°Ù ÙˆÙƒÙŠÙ„" => "remWk"
			),
			array(
				"Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡" => "wk",
			),
			array(
				"Ø§Ø¶Ø§ÙØ© Ø¯ÙˆÙ„Ø©" => "addContry",
				"Ø­Ø°Ù Ø¯ÙˆÙ„Ø©" => "remContry"
			),
			array(
				"Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø§Ø¬Ø¨Ø§Ø±ÙŠ" => "subSettings",
				"Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¯ÙˆÙ„" => "importCountries"
			),
			array(
				"ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©" => "maintenanceSettings",
				"Ø§Ù„Ø§Ø°Ø§Ø¹Ø©" => "broadcast"
			),
			array(
				"Ø§Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ³Ø¹ÙŠØ±" => "pricingSettings",
				"Ø§Ù„Ø§Ø­ØµØ§Ø¦ÙŠØ§Øª" => "stats"
			)				
		)
	
	);
	$info[$id]['action']="";
	saveInfo();
	$tx = "Ø§Ù‡Ù„Ø§ ÙˆØ³Ù‡Ù„Ø§ Ø¨Ùƒ Ø¹Ø²ÙŠØ²ÙŠ Ø§Ù„Ø§Ø¯Ù…Ù†\n Ø±ØµÙŠØ¯Ùƒ ÙÙŠ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø§Ø±Ù‚Ø§Ù… $balance\n\nØ§ÙˆØ§Ù…Ø± Ø§Ù„Ø§Ø¯Ù…Ù†";
	if ($text)
	send($tx,$btn);
	else
	edit($tx,$btn);
} else if ($data == "addPoint") {
	$tx = "Ù‚Ù… Ø¨Ø§Ø±Ø³Ø§Ù„ Ø§ÙŠØ¯ÙŠ Ø§Ù„Ø¹Ø¶Ùˆ";
	$info[$id]['action']="addPointId";
	saveInfo();
	edit($tx,$back);
} else if ($text && ($info[$id]['action'] == "addPointId") ){
	echo "-@Ba_ageel-";
	if(!isset ($points[$text])) {
		//user not exist 
		$tx = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø§ÙŠØ¯ÙŠ";
		send($tx,$back);
	} else {
		$info[$id]['idPoint']  = $text;
		$info[$id]['action']="addPoint";
		saveInfo();
		$tx = "Ù‚Ù… Ø¨Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø§Ø¶Ø§ÙØªÙ‡";
		send($tx,$back);
	}
} else if ($text && $info[$id]['action'] == "addPoint") {
	if( is_numeric($text) && $text > 0 ) {
		$points[$info[$id]['idPoint']] += ($text);
		savePoint();
		$tx = "ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­";
		send($tx,$back);
		$tx=str_replace("__point__",$text,$txt[$lang[$info[$id]['idPoint']]][1]);
		send($tx,null,$info[$id]['idPoint']);
		$info[$id]['idPoint']  = "";
		$info[$id]['action']="";
		saveInfo();
	} else {
		$tx = "ÙŠØ¬Ø¨ Ø§Ù† ØªØ±Ø³Ù„ Ø±Ù‚Ù… Ø§ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ØµÙØ±";
		send($tx,$back);
	}
}else if ($data == "takePoint") {
	$tx = "Ù‚Ù… Ø¨Ø§Ø±Ø³Ø§Ù„ Ø§ÙŠØ¯ÙŠ Ø§Ù„Ø¹Ø¶Ùˆ";
	$info[$id]['action']="takePointId";
	saveInfo();
	edit($tx,$back);
} else if ($text && ($info[$id]['action'] == "takePointId") ){
	echo "-@Ba_ageel-";
	if(!isset ($points[$text])) {
		//user not exist 
		$tx = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø§ÙŠØ¯ÙŠ";
		send($tx,$back);
	} else {
		$info[$id]['idPoint']  = $text;
		$info[$id]['action']="takePoint";
		saveInfo();
		$tx = "Ù‚Ù… Ø¨Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø³Ø­Ø¨Ù‡ Ù…Ù† Ø§Ù„Ø¹Ø¶Ùˆ";
		send($tx,$back);
	}
} else if ($text && $info[$id]['action'] == "takePoint") {
	if( is_numeric($text) && $text > 0 ) {
		$points[$info[$id]['idPoint']] -= ($text);
		savePoint();
		$tx = "ØªÙ… Ø§Ù„Ø³Ø­Ø¨ Ø¨Ù†Ø¬Ø§Ø­";
		send($tx,$back);
		$tx=str_replace("__point__",$text,$txt[$lang[$info[$id]['idPoint']]][2]);
		send($tx,null,$info[$id]['idPoint']);
		$info[$id]['idPoint']  = "";
		$info[$id]['action']="";
		saveInfo();
	} else {
		$tx = "ÙŠØ¬Ø¨ Ø§Ù† ØªØ±Ø³Ù„ Ø±Ù‚Ù… Ø§ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ØµÙØ±";
		send($tx,$back);
	}
} else if ($data == "ban") {
	$tx = "Ù‚Ù… Ø¨Ø§Ø±Ø³Ø§Ù„ Ø§ÙŠØ¯ÙŠ Ø§Ù„Ø¹Ø¶Ùˆ";
	$info[$id]['action']="ban";
	saveInfo();
	edit($tx,$back);
} else if ($text && $info[$id]['action'] == "ban") {
	$tx = "ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ø¹Ø¶Ùˆ Ø¨Ù†Ø¬Ø§Ø­";
	$info[$id]['action']="";
	saveInfo();
	$bans[$text]=$text;
	saveBans();
	send($tx,$back);
	$tx = $txt[$lang[$text]][3];
	send($tx,null,$text);
}else if ($data == "unban") {
	$tx = "Ù‚Ù… Ø¨Ø§Ø±Ø³Ø§Ù„ Ø§ÙŠØ¯ÙŠ Ø§Ù„Ø¹Ø¶Ùˆ";
	$info[$id]['action']="unban";
	saveInfo();
	edit($tx,$back);
}else if ($text && $info[$id]['action'] == "unban") {
	$tx = "ØªÙ… Ø§Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¸Ø± Ø¨Ù†Ø¬Ø§Ø­";
	$info[$id]['action']="";
	saveInfo();
	$bans[$text]=null;
	saveBans();
	send($tx,$back);
	$tx = $txt[$lang[$text]][4];
	send($tx,null,$text);
} else if ($data == "addWk") {
	$tx = "Ù‚Ù… Ø¨Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙÙŠ Ø³Ø·Ø± ÙˆØ§Ù„ÙŠÙˆØ²Ø± ÙÙŠ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ";
	$info[$id]['action']="addWk";
	saveInfo();
	edit($tx,$back);
} else if ($text && $info[$id]['action']=="addWk") {
	$extx = explode ("\n",$text);
	if(count ($extx) == 2) {
		$info['bot']['wk'] [] = array(
			"name" => $extx[0],
			"user" => $extx[1],
		);
		$info[$id]['action']="";
		saveInfo ();
		$tx="ØªÙ…Øª Ø§Ø¶Ø§ÙØ© Ø§Ù„ÙˆÙƒÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­";
		send($tx,$back);
	} else {
		$tx = "Ù‚Ù… Ø¨Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙÙŠ Ø³Ø·Ø± ÙˆØ§Ù„ÙŠÙˆØ²Ø± ÙÙŠ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ";
		send($tx,$back);
	}
} else if ($data == "remWk" ) {
	$btn = array();
	$btn[]= 
		array(
			"Ø§Ù„Ø§Ø³Ù…" => "ntn",
			"Ø§Ù„ÙŠÙˆØ²Ø±" => "ntn"
		);
	
	foreach ($info['bot']['wk'] as $k => $v ) {
		$d= "remWk-{$k}";
		$btn[] = 
			array(
				"{$v['name']}"??""=> $d,
				"{$v['user']}"??"" => $d,
			);
		
	}
	$btn[]=array (
			"Ø±Ø¬ÙˆØ¹" => "back"
		);
	$tx ="Ø§Ø®ØªØ§Ø± Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø­Ø°ÙØ©";
	edit($tx, mkBtn ($btn));
}else if (preg_match("/remWk\-/",$data)) {
	$info['bot']['wk'][explode ("-",$data)[1]]=null;
	unset($info['bot']['wk'][explode ("-",$data)[1]]);
	saveInfo ();
	$tx ="ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­";
	edit($tx, mkBtn ($btn));
} else if ($data == "wk") {
	$btn = array();
	$btn[]= 
		array(
			"Ø§Ù„Ø§Ø³Ù…" => "ntn",
			"Ø§Ù„ÙŠÙˆØ²Ø±" => "ntn"
		);
	
	foreach ($info['bot']['wk'] as $k => $v ) {
		$btn[] = 
			array(
				"{$v['name']}"??""=> "ntn",
				"{$v['user']}"??"" => "ntn",
			);
	}
	$btn[]=array (
			"Ø±Ø¬ÙˆØ¹" => "back"
		);
	$tx ="Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡";
	edit($tx, mkBtn ($btn));
} else if ($data == "subSettings") {
	$status = ($settings['forced_subscription']['enabled'] ?? true) ? "Ù…ÙØ¹Ù„Ø© âœ…" : "Ù…Ø¹Ø·Ù„Ø© âŒ";
	$channelId = $settings['forced_subscription']['channel_id'] ?? $ch5;
	$channelLink = $settings['forced_subscription']['channel_link'] ?? $ch6;
	$tx = "Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ: {$status}\nØ§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: {$channelId}\nØ§Ù„Ø±Ø§Ø¨Ø·: {$channelLink}";
	$btn = mkBtn([
		[
			"ØªÙØ¹ÙŠÙ„" => "toggleSub#on",
			"ØªØ¹Ø·ÙŠÙ„" => "toggleSub#off"
		],
		[
			"ØªØºÙŠÙŠØ± Ø§Ù„Ù‚Ù†Ø§Ø©" => "setSubChannel"
		],
		[
			"Ø±Ø¬ÙˆØ¹" => "back"
		]
	]);
	edit($tx, $btn);
} else if ($exData[0] == "toggleSub") {
	$settings['forced_subscription']['enabled'] = ($exData[1] ?? 'on') === 'on';
	saveSettings();
	$tx = $settings['forced_subscription']['enabled'] ? "ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ." : "ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ.";
	edit($tx, $back);
} else if ($data == "setSubChannel") {
	$tx = "Ø£Ø±Ø³Ù„ Ø§ÙŠØ¯ÙŠ Ø§Ù„Ù‚Ù†Ø§Ø© ÙÙŠ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø£ÙˆÙ„ ÙˆØ§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ.";
	$info[$id]['action'] = "setSubChannel";
	saveInfo();
	edit($tx, $back);
} else if ($text && ($info[$id]['action'] ?? '') === "setSubChannel") {
	$parts = array_values(array_filter(array_map('trim', preg_split("/\r\n|\n|\r/", $text))));
	if (count($parts) < 2) {
		$parts = preg_split('/\s+/', trim($text));
	}
	if (count($parts) >= 2) {
		$settings['forced_subscription']['channel_id'] = $parts[0];
		$settings['forced_subscription']['channel_link'] = $parts[1];
		saveSettings();
		$info[$id]['action'] = "";
		saveInfo();
		$tx = "ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‚Ù†Ø§Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ.";
	} else {
		$tx = "ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ø§ÙŠØ¯ÙŠ Ø§Ù„Ù‚Ù†Ø§Ø© ÙÙŠ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø£ÙˆÙ„ ÙˆØ§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ.";
	}
	edit($tx, $back);
} else if ($data == "importCountries") {
	$get = $api->getCountries();
	if (!is_array($get)) {
		edit("ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø¯ÙˆÙ„ Ù…Ù† Ø§Ù„Ù…Ø²ÙˆØ¯.", $back);
	} else {
		$margin = (float)($settings['pricing']['margin_percent'] ?? 0);
		$applied = 0;
		foreach ($get as $code => $basePrice) {
			if (!is_numeric($basePrice)) {
				continue;
			}
			$price = (float)$basePrice;
			if ($margin !== 0.0) {
				$price += $price * ($margin / 100);
			}
			$contries[$code] = round($price, 2);
			$applied++;
		}
		saveContries();
		$tx = "ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ {$applied} Ø¯ÙˆÙ„Ø© ÙˆØªØ­Ø¯ÙŠØ« Ø£Ø³Ø¹Ø§Ø±Ù‡Ø§.";
		edit($tx, $back);
	}
} else if ($data == "pricingSettings") {
	$margin = $settings['pricing']['margin_percent'] ?? 0;
	$starPrice = $settings['stars']['usd_per_star'] ?? 0.0;
	$tx = "Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„Ø£Ø±Ø¨Ø§Ø­: {$margin}%\nØ³Ø¹Ø± Ø§Ù„Ù†Ø¬Ù…Ø© Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±: {$starPrice}\nÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹ÙŠÙŠÙ† Ù†Ø³Ø¨Ø© Ø¹Ø§Ù…Ø© Ø£Ùˆ Ø³Ø¹Ø± Ù…Ø®ØµØµ Ù„Ø¯ÙˆÙ„Ø© Ù…Ø¹ÙŠÙ†Ø©.";
	$btn = mkBtn([
		[
			"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Ø³Ø¨Ø©" => "setMargin",
			"Ø³Ø¹Ø± Ù…Ø®ØµØµ" => "setCustomPrice"
		],
		[
			"ØªØ¹Ø¯ÙŠÙ„ Ø³Ø¹Ø± Ø§Ù„Ù†Ø¬ÙˆÙ…" => "setStarPrice"
		],
		[
			"Ø±Ø¬ÙˆØ¹" => "back"
		]
	]);
	edit($tx, $btn);
} else if ($data == "setMargin") {
	$info[$id]['action'] = "setMargin";
	saveInfo();
	$tx = "Ø£Ø±Ø³Ù„ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù„Ù„Ø£Ø±Ø¨Ø§Ø­ (Ù…Ø«Ø§Ù„ 15 Ø£Ùˆ 12.5).";
	edit($tx, $back);
} else if ($text && ($info[$id]['action'] ?? '') === "setMargin") {
	if (is_numeric($text)) {
		$settings['pricing']['margin_percent'] = (float)$text;
		saveSettings();
		$info[$id]['action'] = "";
		saveInfo();
		$tx = "ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù„Ù„Ø£Ø±Ø¨Ø§Ø­.";
	} else {
		$tx = "ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ù‚ÙŠÙ…Ø© Ø±Ù‚Ù…ÙŠØ© ÙÙ‚Ø·.";
	}
	edit($tx, $back);
} else if ($data == "setCustomPrice") {
	$info[$id]['action'] = "customPrice";
	saveInfo();
	$tx = "Ø£Ø±Ø³Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø¯ÙˆÙ„Ø© ÙˆØ§Ù„Ø³Ø¹Ø± Ù…Ø«Ø§Ù„: US 1.75";
	edit($tx, $back);
} else if ($text && ($info[$id]['action'] ?? '') === "customPrice") {
	$parts = preg_split('/\s+/', trim($text));
	if (count($parts) === 2 && is_numeric($parts[1])) {
		$code = strtoupper($parts[0]);
		$contries[$code] = (float)$parts[1];
		saveContries();
		$info[$id]['action'] = "";
		saveInfo();
		$tx = "ØªÙ… ØªØ­Ø¯ÙŠØ« Ø³Ø¹Ø± Ø§Ù„Ø¯ÙˆÙ„Ø© {$code}.";
	} else {
		$tx = "ØµÙŠØºØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ù…Ø«Ø§Ù„: US 1.75";
	}
	edit($tx, $back);
} else if ($data == "maintenanceSettings") {
	$mEnabled = $settings['maintenance']['enabled'] ?? false;
	$mMessage = $settings['maintenance']['message'] ?? "Ø§Ù„Ø¨ÙˆØª ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.";
	$status = $mEnabled ? "Ù…ÙØ¹Ù„ âœ…" : "Ù…Ø¹Ø·Ù„ âŒ";
	$tx = "Ø­Ø§Ù„Ø© ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©: {$status}\nØ§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:\n{$mMessage}";
	$btn = mkBtn([
		[
			"ØªÙØ¹ÙŠÙ„" => "toggleMaintenance#on",
			"ØªØ¹Ø·ÙŠÙ„" => "toggleMaintenance#off"
		],
		[
			"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©" => "setMaintenanceMessage"
		],
		[
			"Ø±Ø¬ÙˆØ¹" => "back"
		]
	]);
	edit($tx, $btn);
} else if ($exData[0] == "toggleMaintenance") {
	$settings['maintenance']['enabled'] = ($exData[1] ?? 'on') === 'on';
	saveSettings();
	$tx = $settings['maintenance']['enabled'] ? "ØªÙ… ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©." : "ØªÙ… ØªØ¹Ø·ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©.";
	edit($tx, $back);
} else if ($data == "setMaintenanceMessage") {
	$info[$id]['action'] = "setMaintenanceMessage";
	saveInfo();
	$tx = "Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„ØªÙŠ Ø³ØªØ¸Ù‡Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†:";
	edit($tx, $back);
} else if ($text && ($info[$id]['action'] ?? '') === "setMaintenanceMessage") {
	$settings['maintenance']['message'] = $text;
	saveSettings();
	$info[$id]['action'] = "";
	saveInfo();
	$tx = "ØªÙ… ØªØ­Ø¯ÙŠØ« Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©.";
	edit($tx, $back);
} else if ($data == "broadcast") {
	$info[$id]['action'] = "broadcast";
	saveInfo();
	$tx = "Ø£Ø±Ø³Ù„ Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø¥Ø°Ø§Ø¹ØªÙ‡Ø§ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†.";
	edit($tx, $back);
} else if ($text && ($info[$id]['action'] ?? '') === "broadcast") {
	$audience = array_keys($points ?? []);
	$success = 0;
	foreach ($audience as $uid) {
		if (!$uid) {
			continue;
		}
		send($text, null, $uid);
		$success++;
	}
	$info[$id]['action'] = "";
	saveInfo();
	$tx = "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ {$success} Ù…Ø³ØªØ®Ø¯Ù….";
	edit($tx, $back);
} else if ($data == "addContry" || $exData[0] == 'next' || $exData[0] == 'before') {
	#Lista:
	$get = $api->getCountries();
	$tx="Ø§Ù„Ø¯ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø­Ø©\n";
	if ($data == "addContry" ) {
		$start = 0;
	} else if ($exData[0] == 'next') {
		$start= $exData[1];
		if ($start > count ($get)) {
			bot('answerCallbackQuery',[
				'callback_query_id'=>$update->callback_query->id,
				'show_alert'=>true,
				'text' => "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø§Ø¦Ù…Ø© ØªØ§Ù„ÙŠÙ‡"
			]);
			exit;
		}
	} else if ( $exData[0] == 'before') {
		$start= $exData[1];
		if($start >= 30) {$start -=30;}
		else if ($start > 0) { $start = 0;}
		else  {
			bot('answerCallbackQuery',[
				'callback_query_id'=>$update->callback_query->id,
				'show_alert'=>true,
				'text' => "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø§Ø¦Ù…Ø© Ø³Ø§Ø¨Ù‚Ø©"
			]);
			exit;
		}
	}	
	$end = $start + 30;
	$btn =array();
	$bt=array();
	$count=-1;
	$a=1;
	$btn[]=[['text' => "Ø§Ù„Ø¯ÙˆÙ„Ø© | Ø§Ù„ÙƒÙ„ÙØ©",'callback_data' => "test" ],['text' => "Ø§Ù„Ø¯ÙˆÙ„Ø© | Ø§Ù„ÙƒÙ„ÙØ© ",'callback_data' => "change#$z"]];
	foreach ($get as $k => $p) {
		$count++;
		if($count < $start) continue;
		else if ($count >= $end) break;
		$z = isset($contries[$k])? "âœ…" : "âŒ";
		//$btn[]=[['text' => "{$names[$k]} | $p",'callback_data' => "change#$k#$data" ],['text' => "$z",'callback_data' => "change#$k#$data"]];
		if($a%2==0) {
			$bt[]=['text' => "{$names[$k]} | $p",'callback_data' => "add#$k#$data" ];
			$btn[]=$bt;
			$bt=[];
		} else {
			$bt[]=['text' => "{$names[$k]} | $p",'callback_data' => "add#$k#$data" ];
		}
		$a++;
	}
	if(count($bt)>0) $btn[]=$bt;
	$btn[]=array(
		['text' => "Ø§Ù„Ø³Ø§Ø¨Ù‚ â®ï¸",'callback_data' => "before#{$start}" ],
		['text' => "â­ï¸Ø§Ù„ØªØ§Ù„ÙŠ ",'callback_data' => "next#{$end}" ],
	);
	$btn[]=array(
		['text' =>" Ø±Ø¬ÙˆØ¹ ğŸ”™",'callback_data' => "back" ],
	);
	
	edit($tx,$btn);
} /*else if ($exData[0] == "change") {
	if ( !isset($contries[$exData[1]])) {
		$contries[$exData[1]]=$exData[1];
	} else {
		unset($contries[$exData[1]]);
	}
	saveContries ();
	unset($exData[1]);
	unset($exData[0]);
	$data = implode ("#",$exData);
	$exData=explode ("#",$data);
	goto Lista;
}*/ else if ($data == "stats") {
	$a=$stats['all']['trybuy']??0;
	$b= $stats['all']['buy']??0;
	$tx = "Ø¹Ø¯Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ $a\nØ¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù†Ø§Ø¬Ø­Ø©$b";
	edit ($tx,$back);
} else if ($exData[0] == "add") {
	$info[$id]['action']="addContry";
	$info[$id]['contry']=$exData[1];
	saveInfo();
	$tx = "Ù‚Ù… Ø¨Ø§Ø±Ø³Ø§Ù„ Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹";
	$btn = mkBtn([
		[
			"Ø±Ø¬ÙˆØ¹ğŸ”™" => $exData[2]
		]
	]);
	edit($tx,$btn);
} else if ($text && $info[$id]['action']=="addContry") {
	if ( is_numeric($text) && $text > 0 ) {
		$tx = "ØªÙ…Øª Ø§Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙˆÙ„Ø© Ø¨Ù†Ø¬Ø§Ø­";
		$contries[$info[$id]['contry']]=$text;
		$info[$id]['action']="";
		$info[$id]['contry']="";
		saveInfo();
		saveContries ();
	} else {
		$tx="Ù‚Ù… Ø¨Ø§Ø±Ø³Ø§Ù„ Ù‚ÙŠÙ…Ø© Ø±Ù‚Ù…ÙŠØ© Ø§ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ØµÙØ±";
	}
	send($tx,$back);
} else if ($data == "remContry" || $exData[0] == 'NEXT' || $exData[0] == 'BEFORE') {
	$tx="Ø§Ù„Ø¯ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø­Ø©\n";
	if ($data == "remContry") {
		$start = 0;
	} else if ($exData[0] == 'NEXT') {
		$start= $exData[1];
		if ($start > count ($contries)) {
			bot('answerCallbackQuery',[
				'callback_query_id'=>$update->callback_query->id,
				'show_alert'=>true,
				'text' => "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø§Ø¦Ù…Ø© ØªØ§Ù„ÙŠÙ‡"
			]);
			exit;
		}
	} else if ( $exData[0] == 'BEFORE') {
		$start= $exData[1];
		if($start >= 30) {$start -=30;}
		else if ($start > 0) { $start = 0;}
		else  {
			bot('answerCallbackQuery',[
				'callback_query_id'=>$update->callback_query->id,
				'show_alert'=>true,
				'text' => "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø§Ø¦Ù…Ø© Ø³Ø§Ø¨Ù‚Ø©"
			]);
			exit;
		}
	}	
	$end = $start + 30;
	$btn =array();
	
	$tx="
	Ù‚Ù… Ø¨Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø®Ø°ÙÙ‡Ø§
	";
	$bt=array();
	$count=-1;
	$a=0;
	foreach ($contries as $k => $p) {
		$count++;
		if($count < $start) continue;
		else if ($count >= $end) break;	
		/*$p = $prices[$k];
		$p = $p+($p*$revenue/100);*/
		if($a%2==0) {
			$btn[]=$bt;
			$bt=[];
			$bt[]=['text' => "{$names[$k]} | $p",'callback_data' => "remove#$k"];
		} else {
			$bt[]=['text' => "{$names[$k]} | $p",'callback_data' => "remove#$k" ];
		}
		$a++;
		//$tx .= "$k | {$names[$k]} | $p \n ";	
	}
	if(count($bt)>0) $btn[]=$bt;
	$btn[]=array(
		['text' => "Ø§Ù„Ø³Ø§Ø¨Ù‚ â®ï¸",'callback_data' => "BEFORE#{$start}" ],
		['text' => "â­ï¸Ø§Ù„ØªØ§Ù„ÙŠ ",'callback_data' => "NEXT#{$end}" ],
	);
	$btn[]=array(
	['text' => "Ø±Ø¬ÙˆØ¹ ğŸ”™",'callback_data' => "back" ],
	);
	edit($tx,$btn);
} else if ($exData[0] == "remove") {
	//send($exData[1]);
	$contries[$exData[1]]=null;
	unset($contries[$exData[1]]);
	saveContries ();
	//send(json_encode($contries));
	$tx="ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­";
	edit($tx,$back);
} else if ($data == "setStarPrice") {
	$info[$id]['action'] = "setStarPrice";
	saveInfo();
	$tx = "Ø£Ø±Ø³Ù„ Ø³Ø¹Ø± Ù†Ø¬Ù…Ø© ÙˆØ§Ø­Ø¯Ø© Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± (Ù…Ø«Ø§Ù„ 0.011).";
	edit($tx, $back);
} else if ($text && ($info[$id]['action'] ?? '') === "setStarPrice") {
	if (is_numeric($text) && $text > 0) {
		$settings['stars']['usd_per_star'] = (float)$text;
		saveSettings();
		$info[$id]['action'] = "";
		saveInfo();
		$tx = "ØªÙ… ØªØ­Ø¯ÙŠØ« Ø³Ø¹Ø± Ø§Ù„Ù†Ø¬ÙˆÙ….";
	} else {
		$tx = "ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ù‚ÙŠÙ…Ø© Ø±Ù‚Ù…ÙŠØ© ØµØ­ÙŠØ­Ø©.";
	}
	edit($tx, $back);
}
